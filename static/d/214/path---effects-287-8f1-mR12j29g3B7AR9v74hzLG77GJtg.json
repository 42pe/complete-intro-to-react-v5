{"data":{"markdownRemark":{"html":"<p>Back to React! Let's make our app be able to read live data about animals to adopt! This data is courteous of <a href=\"https://www.petfinder.com/\">Petfinder.com</a>, a wonderful service that provides a free API for adopting animals. Unfortunately, this service is USA-based, so please use USA locations only or else it won't return any results.</p>\n<p>Please register <a href=\"https://www.petfinder.com/developers/api-key\">here</a> for an API key from Petfinder.</p>\n<p>Create a file in the root of your project (same directory as package.json) that is called <code class=\"language-text\">.env</code>. Put this in there:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">API_KEY=&lt;Your API key&gt;\nAPI_SECRET=&lt;Your API secret&gt;</code></pre></div>\n<h3 id=\"️-important-️\"><a href=\"#%EF%B8%8F-important-%EF%B8%8F\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>⚠️ IMPORTANT ⚠️</h3>\n<p>Whenever you add, remove, or change something from your .env file, you need to delete the .cache and dist directories (so that Parcel will do a clean build.) If later you're seeing you're getting unauthorized errors from the API, this is a likely culprit. If it helps, add this to your package.json and run it whenver you change your .env file before running <code class=\"language-text\">npm run dev</code> again.</p>\n<p>If you see an error like this in your console, you're having this problem.</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/complete-intro-to-react-v5/static/905dc98e8816a1073e23d4cb3a26f920/c4694/syntaxError.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 6.099110546378653%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAIAAABR8BlyAAAACXBIWXMAAAsSAAALEgHS3X78AAAARUlEQVQI12MoNnSKt3FPcvZNdPSOsnULtXBMdvJNcvKJsXVPdPJOcPCKd/CMsHaOsfMIMLb0s/HwcwvzdQrw94jysnQBACF4EZyasN9sAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Error saying that you're getting a syntax error due to \"<\"\"\n        title=\"\"\n        src=\"/complete-intro-to-react-v5/static/905dc98e8816a1073e23d4cb3a26f920/ad675/syntaxError.png\"\n        srcset=\"/complete-intro-to-react-v5/static/905dc98e8816a1073e23d4cb3a26f920/07382/syntaxError.png 200w,\n/complete-intro-to-react-v5/static/905dc98e8816a1073e23d4cb3a26f920/8d35a/syntaxError.png 400w,\n/complete-intro-to-react-v5/static/905dc98e8816a1073e23d4cb3a26f920/ad675/syntaxError.png 800w,\n/complete-intro-to-react-v5/static/905dc98e8816a1073e23d4cb3a26f920/d1b74/syntaxError.png 1200w,\n/complete-intro-to-react-v5/static/905dc98e8816a1073e23d4cb3a26f920/c4694/syntaxError.png 1574w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n  </span>\n  </a></p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"clear-build-cache\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"rm -rf .cache/ dist/\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Again, it's critical to clear your build cache first, <em>then</em> stop and start your dev server when you modify your .env file. I'm emphasizing this a lot because a lot of people get tripped up here.</p>\n<p>Now Parcel will read these variables out of your .env file and make them available inside of your app. Now you don't have to commit secrets to your codebase and that's <em>always</em> a good thing. If someone gets access to GitHub for your code, they won't necessarily get your API keys. You'll use a different service like <a href=\"https://azure.microsoft.com/en-us/services/key-vault/?WT.mc_id=react-github-brholt\">Azure Key Vault</a> or <a href=\"https://kubernetes.io/docs/concepts/configuration/secret/\">Kubernetes Secrets</a> to manage your secrets.</p>\n<p>Now that your secrets are in there, let's install the Petfinder Client. I wrote this little wrapper for the API; it's not good. It's optimized for this use case only. Run <code class=\"language-text\">npm install petfinder-client</code>. In App.js, add:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// at the top</span>\n<span class=\"token keyword\">import</span> pf <span class=\"token keyword\">from</span> <span class=\"token string\">\"petfinder-client\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// under imports</span>\n<span class=\"token keyword\">const</span> petfinder <span class=\"token operator\">=</span> <span class=\"token function\">pf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  key<span class=\"token punctuation\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">API_KEY</span><span class=\"token punctuation\">,</span>\n  secret<span class=\"token punctuation\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">API_SECRET</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// inside render method, below useDropdown calls</span>\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  petfinder<span class=\"token punctuation\">.</span>breed<span class=\"token punctuation\">.</span><span class=\"token function\">list</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> animal<span class=\"token punctuation\">:</span> <span class=\"token string\">\"dog\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>console<span class=\"token punctuation\">.</span>log<span class=\"token punctuation\">,</span> console<span class=\"token punctuation\">.</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>pf takes in credentials and returns an API object. You only have to give it credentials here; anywhere else you import it it'll retain the same credentials. The API response has a silly and ridiculous structure.</li>\n<li>Here we're using an effect to retrieve a list of breeds from the API. An effect is run after every render (which happens after state changes.) You're going to use effects to do things like AJAX calls, modify ambient state, integrate with other libraries, and many other things. Basically it's a way to delay work until after render happens and to deal with asynchronous side effects.</li>\n<li>If you're familiar with previous versions of React, effects can take the place of <em>most</em> life cycle methods. In this case we're going to use it instead of <code class=\"language-text\">componentDidMount</code> and <code class=\"language-text\">componentDidUpdate</code>.</li>\n</ul>\n<p>So rather just having <code class=\"language-text\">dog</code> be the static animal, let's make that dynamic and let's make it actually save the breed it gets.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// replace effect</span>\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  petfinder<span class=\"token punctuation\">.</span>breed<span class=\"token punctuation\">.</span><span class=\"token function\">list</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> animal <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>data <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">updateBreeds</span><span class=\"token punctuation\">(</span>\n      Array<span class=\"token punctuation\">.</span><span class=\"token function\">isArray</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>petfinder<span class=\"token punctuation\">.</span>breeds<span class=\"token punctuation\">.</span>breed<span class=\"token punctuation\">)</span>\n        <span class=\"token operator\">?</span> data<span class=\"token punctuation\">.</span>petfinder<span class=\"token punctuation\">.</span>breeds<span class=\"token punctuation\">.</span>breed\n        <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>data<span class=\"token punctuation\">.</span>petfinder<span class=\"token punctuation\">.</span>breeds<span class=\"token punctuation\">.</span>breed<span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> console<span class=\"token punctuation\">.</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>animal<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>Due to JavaScript closures (the fact that state is preserved for various render function calls) we're able to reference updateBreeds from the outer scope. We use this to update the breed after the successful call to the petfinder API.</li>\n<li>Petfinder API does weird stuff where it returns an array if there are more than one breed but just returns a string if there's only one. It's dumb.</li>\n<li>The array at the end is peculiar but essential. By default, effects will run at the end of every re-render. This is problematic for us because we're updating breeds, which causes a re-render, which causes another effect, which causes another re-render, etc. What you can to prevent this spiral is give it an array at the end of variables as a second parameter. Now this effect will only happen if one of those variables changes. In this case, it will only cause the effect if <code class=\"language-text\">animal</code> changes. Which is exactly what we want.</li>\n<li>Effects are always called after the first render no matter what.</li>\n</ul>\n<p>We want to console.error the messages if there's an error. Let's go turn that warning off in ESLint.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"rules\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    …<span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"no-console\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"warn\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>It's useful to have ESLint bug you about taking console logs out but some times you do want them. Feel free to turn it off if it suits you.</li>\n</ul>\n<p>Whenever a user selects a new animal, we need to programtically update the breed. Since we put this into a custom hook, we have no way to do that. Let's go make it do that. In useDropdown.js:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// update return</span>\n<span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>state<span class=\"token punctuation\">,</span> Dropdown<span class=\"token punctuation\">,</span> updateState<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now users can optionally programatically accept that function to update their components. Let's use this in the component. In SearchParams.js</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// replace BreedDropdown declaration</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>breed<span class=\"token punctuation\">,</span> BreedDropdown<span class=\"token punctuation\">,</span> updateBreed<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useDropdown</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Breed\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> breeds<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// first line of the function inside useEffect</span>\n<span class=\"token function\">updateBreed</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now it updates the breed to empty whenever you change animal since you can't have a poodle cat (as cool as that sounds).</p>\n<p> </p>\n<h2 id=\"-f702290c687a717356403dabd97658b3bbce7ad0\"><a href=\"#-f702290c687a717356403dabd97658b3bbce7ad0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🌳 <a href=\"https://github.com/btholt/complete-intro-to-react-5/commit/f702290c687a717356403dabd97658b3bbce7ad0\">f702290c687a717356403dabd97658b3bbce7ad0</a></h2>\n<p><strong>To use reset code to this commit:</strong></p>\n<ul>\n<li><code class=\"language-text\">git checkout f702290c687a717356403dabd97658b3bbce7ad0 -f</code></li>\n<li><code class=\"language-text\">npm install</code></li>\n<li>Add API keys to your <code class=\"language-text\">.env</code> file</li>\n<li>Run <code class=\"language-text\">npm run dev</code>.</li>\n</ul>\n<p> </p>","frontmatter":{"path":"/effects","title":"Effects","order":7}},"allMarkdownRemark":{"edges":[{"node":{"frontmatter":{"order":1,"path":"/intro","title":"Introduction"}}},{"node":{"frontmatter":{"order":2,"path":"/pure-react","title":"Pure React"}}},{"node":{"frontmatter":{"order":3,"path":"/eslint-prettier","title":"npm, ESLint & Prettier"}}},{"node":{"frontmatter":{"order":4,"path":"/parcel","title":"Parcel"}}},{"node":{"frontmatter":{"order":5,"path":"/jsx","title":"JSX"}}},{"node":{"frontmatter":{"order":6,"path":"/hooks","title":"Hooks"}}},{"node":{"frontmatter":{"order":7,"path":"/effects","title":"Effects"}}},{"node":{"frontmatter":{"order":8,"path":"/dev-tools","title":"Dev Tools"}}},{"node":{"frontmatter":{"order":9,"path":"/async","title":"Handling Async"}}},{"node":{"frontmatter":{"order":10,"path":"/reach-router","title":"Reach Router"}}},{"node":{"frontmatter":{"order":11,"path":"/class-components","title":"Class Components"}}},{"node":{"frontmatter":{"order":12,"path":"/error-boundaries","title":"Error Boundaries"}}},{"node":{"frontmatter":{"order":13,"path":"/context","title":"Context"}}},{"node":{"frontmatter":{"order":14,"path":"/portals-and-refs","title":"Portals and Refs"}}},{"node":{"frontmatter":{"order":15,"path":"/conclusion","title":"Conclusion"}}},{"node":{"frontmatter":{"order":16,"path":"/hooks-in-depth","title":"Hooks in Depth"}}},{"node":{"frontmatter":{"order":17,"path":"/emotion","title":"Emotion"}}},{"node":{"frontmatter":{"order":19,"path":"/code-splitting","title":"Code Splitting"}}},{"node":{"frontmatter":{"order":19,"path":"/typescript","title":"TypeScript"}}},{"node":{"frontmatter":{"order":20,"path":"/ssr","title":"Server Side Rendering"}}},{"node":{"frontmatter":{"order":21,"path":"/redux","title":"Redux"}}},{"node":{"frontmatter":{"order":22,"path":"/testing","title":"Testing"}}}]}},"pageContext":{}}